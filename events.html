<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>All Events - CampusEvents</title>
    <link rel="stylesheet" href="styles.css">

</head>
<body>

<header>
    <h2 class="logo"></h2>
    <h2 class = "companyname"><a href="mainpage.html" style="color: inherit; text-decoration: none;">CampusEvents</a></h2>
    <nav class="navigation">
        <a href="mainpage.html">Home</a>
        <a href="contact.html">Contact</a>
        <a href="register.html" class="signInButton">Sign In</a>
        <a href="login.html" class="loginbutton">Log In</a>
        <a href="/auth/google" class="connect-google">Connect Google Calendar</a>

    </nav>
</header>

<main>
<div class="filter-bar">
    <label for="filterType">Filter by:</label>
    <select id="filterType">
        <option value="club">Club</option>
        <option value="price">Price</option>
        <option value="date">Date</option>
    </select>

    <label for="filterValue">Select:</label>
    <select id="filterValue">
    </select>
</div>
<div id="messageBox"></div>

<div class="event-grid" id="eventGrid">
</div>

<script src="https://cdn.jsdelivr.net/npm/mixitup@3/dist/mixitup.min.js"></script>
<script>
const events = [
    { title:"Hackathon 2025", date:"2025-12-15", time : "8 am ",location:"Engineering Club", price:10, image:"hackathon.png", details:"24-hour coding challenge!" },
    { title:"Karaoke Night", date:"2025-02-21", time : "6 pm ",location:"Business Club", price:5, image:"karaoke.png", details:"Sing your heart out" },
    { title:"Arts and Crafts", date:"2025-03-25", time :"5 pm ",location:"Arts Club", price:8, image:"artsandcrafts.png", details:"Explore arts and painting ." },
    { title:"Chess Night", date:"2025-04-02", time : "7 pm" ,location:"Finance Club", price:7, image:"chess.png", details:"Chess tournament 1V1" },
    { title:"Movie Night", date:"2025-01-10", time : "8 pm" ,location:"Cinema Club", price:6, image:"movie.png", details:"Watch latest movies together." },
    { title:"Cooking Workshop", date:"2025-02-28", time : "4 pm" ,location:"Culinary Club", price:12, image:"cooking.png", details:"Learn some delicious recipes." },
    { title:"Dance Battle", date:"2025-03-15", time : "6 pm" , location:"Dance Club", price:8, image:"dance.png", details:"Show your moves." },
    { title:"Gaming Tournament", date:"2025-05-05", time : "5 pm" ,location:"Gaming Club", price:10, image:"gaming.png", details:"Compete in esports." },
    { title:"Book Club Meetup", date:"2025-06-12", time : "11 am" , location:"Library", price:5, image:"book.png", details:"Discuss latest books." }
];

const eventGrid = document.getElementById('eventGrid');
events.forEach(event => {
    const card = document.createElement('div');
    card.classList.add('event-card', 'mix', event.location.replace(/\s+/g,''));
    card.setAttribute('data-price', event.price);
    card.setAttribute('data-date', event.date);
    card.setAttribute('data-club', event.location.replace(/\s+/g,''));
    card.innerHTML = `
        <img src="${event.image || 'placeholder.png'}" alt="${event.title}">
        <h3>${event.title}</h3>
        <p><strong>Date:</strong> ${event.date}</p>
        <p><strong>Time:</strong> ${event.time}</p>
        <p><strong>Location:</strong> ${event.location}</p>
        <p>${event.details || ''}</p>
        <div class="event-footer">
            <span class="price">$${event.price}</span>
            <button class="buy-button">Buy</button>
            <!-- <button class="save-button" onclick="saveEvent('${event.title}', '${event.date}', '${event.location}')">Save</button> -->
        </div>
    `;

    eventGrid.appendChild(card);
});

const mixer = mixitup('#eventGrid', {
    selectors: { target: '.mix' },
    animation: { duration: 300 }
});

const filterType = document.getElementById('filterType');
const filterValue = document.getElementById('filterValue');

function updateFilterOptions() {
    filterValue.innerHTML = '';
    const type = filterType.value;
    let uniqueOptions = [];
    if(type === 'club') uniqueOptions = [...new Set(events.map(e => e.location))];
    if(type === 'price') uniqueOptions = [...new Set(events.map(e => e.price))];
    if(type === 'date') uniqueOptions = [...new Set(events.map(e => e.date))];

    filterValue.innerHTML = `<option value="all">All</option>`;
    uniqueOptions.forEach(opt => {
        const option = document.createElement('option');
        option.value = type === 'club' ? '.' + opt.replace(/\s+/g,'') : `[data-${type}='${opt}']`;
        option.textContent = opt;
        filterValue.appendChild(option);
    });
    mixer.filter('all');
}

filterType.addEventListener('change', updateFilterOptions);
filterValue.addEventListener('change', () => mixer.filter(filterValue.value));

updateFilterOptions();
// Show confirmation save message
function showMessage(text, color) {
  const box = document.getElementById("messageBox");
  box.textContent = text;
  box.style.background = color;
  box.style.display = "block";
  
  // fade + slide in
  setTimeout(() => {
    box.style.opacity = "1";
    box.style.transform = "translateY(0)";
  }, 10);

  // fade out after 2 seconds
  setTimeout(() => {
    box.style.opacity = "0";
    box.style.transform = "translateY(20px)";
    setTimeout(() => (box.style.display = "none"), 500);
  }, 2000);
}

/*
// Save event function
function saveEvent(title, date, location) {
    //add a "if logged event saved" and "if not logged in, send the login page"
    console.log("saveEvent called:", title);
  let savedEvents = JSON.parse(localStorage.getItem('savedEvents')) || [];
  const exists = savedEvents.some(event => event.title === title && event.date === date);

  if (!exists) {
    savedEvents.push({ title, date, location });
    localStorage.setItem('savedEvents', JSON.stringify(savedEvents));
    showMessage("Event successfully added!", "#4caf50");
  } else {
    showMessage("Event already saved.", "#f1c40f");
  }
} */

async function buyEvent(title, date, location, description) {
  try {
    const response = await fetch("/api/buy", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        title,
        description,
        location,
        starts_at: `${date}T09:00:00-05:00`,
        ends_at: `${date}T11:00:00-05:00`
      })
    });

    const result = await response.json();
    const color = response.ok ? "#4caf50" : "#f44336";
    const message = response.ok
      ? "Event added to Google Calendar!"
      : `Error: ${result.message}`;

    showMessage(message, color);
  } catch (err) {
    console.error("buyEvent error:", err);
    showMessage("Failed to connect to server.", "#f44336");
  }
}

// Check if Google account connected
if (location.search.includes("connected=true")) {
  showMessage("Google Account connected!", "#4caf50");
  history.replaceState({}, document.title, location.pathname);
}
</script>
</body>
</html>
